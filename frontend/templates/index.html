<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypothesis Forge Dashboard</title>
    <!-- Link to custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="stApp">
        <!-- Header -->
        <h1>Hypothesis Forge: AI-Driven Scientific Discovery</h1>
        <p>Explore simulation results and ranked hypotheses for protein folding and astrophysical simulations.</p>

        <!-- Sidebar -->
        <div class="stSidebar">
            <h2>Navigation</h2>
            <div id="navigation-radio">
                <!-- Streamlit will inject radio buttons here -->
            </div>
        </div>

        <!-- Main Content -->
        <main>
            <!-- Simulation View -->
            <section id="simulations-view" style="display: block;">
                <h2>Simulation Results</h2>
                <select id="simulation-selector">
                    <!-- Streamlit will populate options dynamically -->
                </select>
                <div id="protein-viz" style="width: 100%; height: 500px;">
                    <p id="protein-viz-fallback">Loading protein visualization...</p>
                </div>
                <div id="astro-viz" style="width: 100%; height: 500px;">
                    <p id="astro-viz-fallback">Loading astrophysical visualization...</p>
                </div>
                <div class="stExpander">
                    <details>
                        <summary>View Raw Simulation Data</summary>
                        <div id="raw-data-table">
                            <!-- Streamlit will inject table here -->
                        </div>
                    </details>
                </div>
            </section>

            <!-- Hypotheses View -->
            <section id="hypotheses-view" style="display: none;">
                <h2>Ranked Hypotheses</h2>
                <div id="hypothesis-list">
                    <p id="hypothesis-list-fallback">Loading hypotheses...</p>
                </div>
                <div id="hypothesis-bar-plot" class="plotly-graph-div">
                    <!-- Streamlit will inject Plotly bar plot here -->
                </div>
            </section>
        </main>
    </div>

    <!-- Link to custom JavaScript -->
    <script src="/static/js/interactive.js"></script>
    <!-- Fallback for JavaScript errors -->
    <script>
        try {
            console.log('Inline script loaded at', new Date().toISOString());
            window.proteinData = window.proteinData || [];
            window.hypotheses = window.hypotheses || [];
            window.streamlitDataReady = false;

            function toggleView(view) {
                console.log('Toggling view to:', view);
                document.getElementById('simulations-view').style.display = view === 'Simulations' ? 'block' : 'none';
                document.getElementById('hypotheses-view').style.display = view === 'Hypotheses' ? 'block' : 'none';
            }

            document.addEventListener('streamlit:render', (event) => {
                try {
                    console.log('Streamlit render event:', event.detail);
                    const data = event.detail.args || {};
                    window.proteinData = data.proteinData || [];
                    window.hypotheses = data.hypotheses || [];
                    window.streamlitDataReady = true;
                    toggleView(data.view || 'Simulations');
                } catch (e) {
                    console.error('Error in Streamlit render:', e);
                    document.getElementById('protein-viz-fallback').innerText = 'Error loading visualization';
                    document.getElementById('hypothesis-list-fallback').innerText = 'Error loading hypotheses';
                }
            });
        } catch (e) {
            console.error('JavaScript initialization error:', e);
            document.getElementById('protein-viz-fallback').innerText = 'Error loading visualization';
            document.getElementById('hypothesis-list-fallback').innerText = 'Error loading hypotheses';
        }
    </script>
</body>
</html>
